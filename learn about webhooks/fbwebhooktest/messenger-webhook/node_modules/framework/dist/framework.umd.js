((e,t)=>{'object'==typeof exports&&'undefined'!=typeof module?t(exports,require('@loadable/component'),require('react-router-config'),require('effector'),require('patronum'),require('history')):'function'==typeof define&&define.amd?define(['exports','@loadable/component','react-router-config','effector','patronum','history'],t):t((e='undefined'!=typeof globalThis?globalThis:e||self).framework={},e.loadable,e.ReactRouterConfig,e.effector,e.patronum,e.History)})(this,((e,t,r,effector,o,a)=>{function n(e){return e&&'object'==typeof e&&'default'in e?e:{default:e}}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((t=>Object.getOwnPropertyDescriptor(e,t).enumerable))),r.push.apply(r,o)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),1).forEach((t=>{s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((t=>{Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:1,configurable:1,writable:1}):e[t]=r,e}function f(e){return e[l]}var d=n(t);const u=effector.createDomain('framework/default',{name:"defaultDomain",sid:"-tzcbvc"}),l='framework/page-hatch';Object.defineProperty(e,'loadable',{enumerable:1,get:()=>d.default}),e.contract=e=>{for(const t in e.page){const r=e.page[t],o=e.model[t];r&&o&&effector.is.unit(r)&&effector.is.unit(o)&&(effector.is.store(r,{sid:"xrdgy2"})&&effector.is.store(o,{sid:"xrdih6"})?(effector.forward({ɔ:{from:o,to:r},config:{sid:"m1otzj"}}),r.defaultState=o.defaultState,r.stateRef.current=o.stateRef.current,r.stateRef.before=[{type:'map',fn:e=>e,from:o.stateRef}]):effector.forward({ɔ:{from:r,to:o},config:{sid:"n1fgk0"}}))}},e.createBrowserApplication=e=>{const t=e.domain||u,n=(e=>{const t='undefined'!=typeof document?a.createBrowserHistory():null,r=e.createEffect({name:"historyPush",sid:"o1x4sa"}),o=e.createEffect({name:"historyPushSearch",sid:"xiuw4b"}),n=e.createEffect({name:"historyReplace",sid:"-qrkbw9"}),i=e.createEvent({name:"historyChanged",sid:"oxh1xh"}),c=e.createEvent({name:"historyEmitCurrent",sid:"m2f96k"});return'test'!==process.env.NODE_ENV&&(r.use((e=>null==t?void 0:t.push(e))),n.use((e=>null==t?void 0:t.replace(e))),o.use((e=>null==t?void 0:t.push({search:e}))),null==t||t.listen((({pathname:e,search:t,hash:r},o)=>{i({pathname:e,search:t,hash:r,action:o})})),effector.sample({ɔ:[{source:c,fn:()=>({action:'REPLACE',hash:null==t?void 0:t.location.hash,pathname:null==t?void 0:t.location.pathname,search:null==t?void 0:t.location.search}),target:i}],config:{sid:"kzz792"}})),{history:t,historyPush:r,historyPushSearch:o,historyReplace:n,historyChanged:i,historyEmitCurrent:c}})(t);effector.forward({ɔ:{from:e.ready,to:n.historyEmitCurrent},config:{sid:"a2fxhi"}});const i=n.historyChanged.filterMap((t=>{const o=r.matchRoutes(e.routes,t.pathname);if(o.length>0)return c(c({},o[0]),{},{change:t})}));for(const{component:r,path:a}of e.routes){if(!r)return;const{routeMatched:e,__:n}=o.splitMap({source:i,cases:{routeMatched:({route:e,match:t,change:r})=>{if(e.path===a)return{params:t.params,query:Object.fromEntries(new URLSearchParams(r.search))}}}}),c=t.createEvent({name:"hatchEnter",sid:"-v65ud0"}),s=t.createEvent({name:"hatchUpdate",sid:"2pt9rt"}),d=t.createEvent({name:"hatchExit",sid:"9jqgv9"}),u=t.createEvent({name:"dontNeedLoadChunk",sid:"-nsb40i"}),l=t.createStore(0,{name:"$chunkLoaded",sid:"-4kqdl4"}),p=t.createStore(void 0!==f(r),{name:"$hasHatch",sid:"fjkblq"}),h=t.createEffect((async()=>{const e=r.load;if('function'==typeof e){const t=await e();return t.default?t.default:(console.info(`Not found default export for "${a}" route`),null)}return r}),{name:"loadPageFx",sid:"-qstag2"}),m=t.createEffect((e=>{const t=f(e);return t?(effector.forward({ɔ:{from:c,to:t.enter},config:{sid:"cw5veh"}}),effector.forward({ɔ:{from:s,to:t.update},config:{sid:"cwpnzu"}}),effector.forward({ɔ:{from:d,to:t.exit},config:{sid:"cx9gl7"}}),1):0}),{name:"setupHatchLinksFx",sid:"-rikxkp"}),g=t.createStore(0,{name:"$onRoute",sid:"wfxrk6"}).on(e,(()=>1)).on(n,(()=>0)),y=t.createStore(0,{name:"$onPage",sid:"hfkz8f"}).on(c,(()=>1)).on(d,(()=>0));l.on(h.done,(()=>1)).on(u,(()=>1)),p.on(m.doneData,((e,t)=>t)),effector.guard({ɔ:[{source:e,filter:effector.combine({ɔ:[p,l,(e,t)=>!e&&!t],config:{name:"filter",sid:"tg5siz"}}),target:h}],config:{sid:"oqwhym"}}),effector.guard({ɔ:[{source:h.doneData,filter:e=>null!==e,target:m}],config:{sid:"p8hwy6"}}),effector.guard({ɔ:[{source:e,filter:effector.combine({ɔ:[p,l,(e,t)=>e&&!t],config:{name:"filter",sid:"-cp7bea"}}),target:[m.prepend((()=>r)),u]}],config:{sid:"pofy5n"}}),effector.guard({ɔ:[{source:e,clock:m.doneData,filter:g,target:c}],config:{sid:"psuawj"}}),effector.guard({ɔ:[{source:e,filter:y,target:s}],config:{sid:"q88jin"}}),effector.guard({ɔ:[{source:n,filter:y,target:d}],config:{sid:"qnms4r"}})}return{navigation:n}},e.createHatch=(e=u)=>{const t=e.createStore(0,{name:"$opened",sid:"-5kdggg"}),r=e.createStore({},{name:"$params",sid:"-lt6ylq"}),o=e.createStore({},{name:"$query",sid:"-ttwijs"}),a={enter:e.createEvent({name:"enter",sid:"-tugzqm"}),update:e.createEvent({name:"update",sid:"rhre0v"}),exit:e.createEvent({name:"exit",sid:"-q61tqt"}),$opened:t,$params:r,$query:o,$props:effector.combine({ɔ:[{params:r,query:o}],config:{name:"$props",sid:"ld17jr"}})};return r.on([a.enter,a.update],((e,{params:t})=>t)),o.on([a.enter,a.update],((e,{query:t})=>t)),a.$opened.on(a.enter,(()=>1)).on(a.exit,(()=>0)),a},e.createPages=e=>r.renderRoutes(e),e.getHatch=f,e.lookupHatch=e=>{if(e.route.component)return f(e.route.component)},e.withHatch=(e,t)=>(t[l]=e,t),Object.defineProperty(e,'__esModule',{value:1})}));
//# sourceMappingURL=framework.umd.js.map
